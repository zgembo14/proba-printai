<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generisanje i Prikaz Slike</title>
    <!-- Uključivanje midjourney-api.js fajla -->
    <script src="midjourney-api.js" defer></script>
    <!-- Uključivanje get-image.js fajla -->
    <script src="get-image.js" defer></script>
</head>
<body>

    <h1>Generisanje i Prikaz Slike</h1>

    <form id="imageForm">
        <label for="promptInput">Unesite prompt:</label>
        <input type="text" id="promptInput" placeholder="Unesite prompt...">
        <button type="submit">Posalji prompt</button>
    </form>

    <div id="imageContainer" style="width: 500px; height: 500px; border: 1px solid #ccc;"></div>

    <script>
        document.getElementById('imageForm').addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevents the form from submitting and reloading the page
            
            const promptValue = document.getElementById('promptInput').value;
            
            try {
                // POST zahtev za generisanje slike
                const generateResponse = await generateImage(promptValue);
                const generateData = await generateResponse.json();
                console.log('Generisanje slike:', generateData);

                // GET zahtev za dobijanje slike
                const imageId = generateData.data.id;
                const getImageResponse = await getImage(imageId);
                const imageData = await getImageResponse.json();
                console.log('Podaci o slici:', imageData);

                // Prikazivanje slike na stranici
                const imageContainer = document.getElementById('imageContainer');
                imageContainer.innerHTML = ''; // Očisti prethodni sadržaj
                const imageElement = document.createElement('img');
                imageElement.src = imageData.data.url; // Pretpostavljamo da je URL dostupan u odgovoru
                imageElement.style.width = '100%';
                imageElement.style.height = '100%';
                imageContainer.appendChild(imageElement);
                
            } catch (error) {
                console.error('Greška:', error);
                alert('Došlo je do greške. Pogledajte konzolu za više informacija.');
            }
        });

        async function generateImage(promptValue) {
            const data = {
                prompt: promptValue
            };

            return fetch('https://demo.imagineapi.dev/items/images/', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer GiZRBf7SZji_BYCfqMZ7PpelUNejnafb', // TODO: Promenite ovo
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
        }

        async function getImage(imageId) {
            return fetch(`https://demo.imagineapi.dev/items/images/${imageId}`, {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer GiZRBf7SZji_BYCfqMZ7PpelUNejnafb ', // TODO: Promenite ovo
                    'Content-Type': 'application/json'
                }
            });
        }
    </script>

</body>
</html>
